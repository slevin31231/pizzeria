# ОКей піцерія

Додаток для онлайн замовлення піци з доставкою.

Навчальний проект.

Додаток написано на Java і Spring Boot з використанням Maven як засобу складання.

Щоб запустити додаток потрібно встановити Docker і Docker Compose.

## Запуск додатка

Для запуску контейнерів використовуйте команду:

```bash
docker-compose up
```

## Графічний інтерфейс

Графічний інтерфейс додатка створено за допомогою шаблонізатора Thymeleaf.

### Домашня Сторінка

Домашня сторінка доступна за посиланням: http://localhost:8080

На домашній сторінці можна вибрати піцу з меню по її номеру, 
або створити власну піцу, обравши з доступних інгредієнтів.
Додаток не дозволить обрати більше ніж 7 інгредієнтів.

При створенні власної піци додаток перевірить чи є піца з такими інгредієнтами в меню, і якщо її не має,
створить нову, назначить їй ціну та вагу, в залежності від кількості інгредієнтів, 
та додасть її до меню під наступним номером, що зробить цю піцу доступною в меню при наступному виборі.

### Сторінка замовлення

На сторінці замовлення можна додавати або видаляти піци з замовлення.
Додаток не дозволить додати до замовлення більше ніж 10 піц.

Сторінка замовлення містить провалідовані поля форми, які є обов'язковими для заповнення. 
У разі некоректного заповнення полів форми додаток не дозволить перейти до наступної сторінки 
та видасть повідомлення про помилку з рекомендаціями щодо коректного заповнення.
Поле форми "Номер картки" перевіряється алгоритмом Луна.

### Сторінка деталі замовлення

На сторінці деталі замовлення можна, при необхідності, внести зміни в дані замовлення та підтвердити його.
При підтвердженні замовлення додаток збереже інформацію про замовлення в базу даних PostgreSQL, 
що підключана у контейнері, та поверне користувача на домашню сторінку для оформлення наступного замовлення.

## RESTful API

API додатку захищене за допомогою Spring Security та JWT.
Обмін даними відбувається у форматі `JSON` з використанням `HTTP` методів через кінцеві точки, що вказані далі.

Для роботи з API зручно використовувати додаток Postman.
Також можна користуватися утилітою командного рядка curl.

### JWT аутентифікація та авторизація

Перш ніж працювати з API потрібно отримати JWT токен, що буде дійсний протягом 15 хвилин. 
JWT токен необхідно передавати при кожному запиті, вказуючи заголовок `Authorization` 
і токен у форматі `Bearer <токен>`. Щоб отримати JWT токен необхідно пройти аутентифікацію 
використовуючи `HTTP` метод `POST` за посиланням: http://localhost:8080/api/auth/login 
і передати у запиті `JSON`:

````json
{
   "name": "PizzeriaAdministrator",
   "password": "AdminPass",
   "role": "ROLE_ADMIN"
}
````
для адміністратора, або: 

````json
{
   "name": "PizzeriaEmployee",
   "password": "EmployeePass",
   "role": "ROLE_USER"
}
````
для користувача.

Користувачеві з роллю `ROLE_USER` доступні лише кінцеві точки з методом `GET`,
в той час як користувачеві з роллю `ROLE_ADMIN` також будуть доступні кінцеві точки з методами
`POST`, `PUT` і `DELETE`.

### Замовлення

Додаток дозволяє отримувати інформацію про замовлення і видаляти замовлення з бази даних.

Кінцеві точки:
* `GET` http://localhost:8080/api/orders - отримання всіх замовлень.
* `GET` http://localhost:8080/api/orders/{id} - отримання замовлення по id.
* `DELETE` http://localhost:8080/api/orders/{id} - видалення замовлення по id.

### Інгредієнти

Додаток дозволяє отримувати інформацію про інгредієнти,
видаляти інгредієнти, редагувати інгредієнти і додавати нові інгредієнти до бази даних.

Кінцеві точки:
* `GET` http://localhost:8080/api/ingredients - отримання всіх інгредієнтів.
* `GET` http://localhost:8080/api/ingredients/{id} - отримання інгредієнта по id.
* `POST` http://localhost:8080/api/ingredients - додавання нового інгредієнта.
* `PUT` http://localhost:8080/api/ingredients/{id} - редагування інгредієнта по id.
* `DELETE` http://localhost:8080/api/ingredients/{id} - видалення інгредієнта по id.

Для додавання нового інгредієнта і редагування інгредієнта по id, 
у запиті необхідно передати `JSON` у наступному форматі:

```json
{
  "name": "Гострий перець чилі",
  "type": "VEGETABLE"
}
```

Є 4 типи інгредієнтів: `MEAT`, `VEGETABLE`, `CHEESE` і `SEAFOOD`.

### Піци

Додаток дозволяє отримувати інформацію про піци, 
видаляти піци, редагувати піци, і додавати нові піци до бази даних.

Кінцеві точки:
* `GET` http://localhost:8080/api/pizzas - отримання всіх піц.
* `GET` http://localhost:8080/api/pizzas/{id} - отримання піци по id.
* `POST` http://localhost:8080/api/pizzas - додавання нової піци.
* `PUT` http://localhost:8080/api/pizzas/{id} - редагування піци по id.
* `DELETE` http://localhost:8080/api/pizzas/{id} - видалення піци по id.

Для додавання нової піци і редагування піци по id необхідно передати в запиті `JSON` у наступному форматі:

```json
{
  "namesOfIngredients": [ "Пепероні", "Помідори" ],
  "priceForSmall": 140,
  "priceForBig": 180,
  "weightForSmall": 650,
  "weightForBig": 865
}
```

### Валідація даних
Додаток перевірить отримані дані на:
* помилки у назвах полів, 
* відсутність деяких полів, 
* дублювання даних, 
* наявність JWT токену,
* термін дії JWT токену,
* помилки у даних JWT токену.

Якщо у отриманих даних є помилки валідації,
додаток передасть у відповіді `JSON` з даними про ці помилки.
